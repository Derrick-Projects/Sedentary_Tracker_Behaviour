# ============================================
# SEDENTARY TRACKER CONFIGURATION
# ============================================
# Copy this file to .env and update with your values
# cp .env.example .env
#
# For GitHub Codespaces: The defaults work out of the box!
# Just run: docker compose up

# ============================================
# DATABASE CONFIGURATION
# ============================================
# PostgreSQL connection string (format: postgres://user:password@host:port/database)
# Note: In Docker, DATABASE_URL is overridden to use container hostname 'db'
DATABASE_URL=postgres://<user>:<password>@<host>:<port>/<database>

# Individual database connection parameters
POSTGRES_USER=<user>
POSTGRES_PASSWORD=<password>
POSTGRES_DB=<database>
POSTGRES_HOST=<host>
POSTGRES_PORT=<port>

# Maximum number of database connections in the pool
DB_MAX_CONNECTIONS=5

# ============================================
# REDIS CONFIGURATION
# ============================================
# Redis connection URL (format: redis://host:port/)
# Note: In Docker, REDIS_URL is overridden to use container hostname 'redis'
# Default
REDIS_URL=redis://<host>:<port>/

# Individual Redis connection parameters
#These are default
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0

# ============================================
# AUTHENTICATION & SECURITY
# ============================================
# Default user ID for sensor data association (UUID format)
# All sensor readings will be linked to this user in the sensor_data table
# Leave empty to skip sensor_data mirroring
# Generate with: uuidgen (Linux/Mac) or [guid]::NewGuid() (PowerShell)
DEFAULT_USER_ID=...

# JWT secret key - MUST be changed in production! (generate with: openssl rand -hex 32)
JWT_SECRET=${JWT_SECRET}

# JWT token expiration time in hours
JWT_EXPIRY_HOURS=1

# Rate limiting configuration
RATE_LIMIT_MAX_ATTEMPTS=5
RATE_LIMIT_WINDOW_SECONDS=60

# ============================================
# HARDWARE / ARDUINO CONFIGURATION
# ============================================
# Serial port for Arduino connection
# Linux/Mac: /dev/ttyACM* or /dev/ttyUSB*
# Windows: COM3, COM4, etc.
# Codespaces/Cloud: /dev/null (fallback mode activates automatically)
SERIAL_PORT=/dev/null

# Arduino serial communication baud rate
BAUD_RATE=<baud_rate>

# Serial port timeout in milliseconds
SERIAL_TIMEOUT_MS=1000

# ============================================
# SERVER CONFIGURATION
# ============================================
# Server bind address and port
SERVER_ADDRESS=0.0.0.0:8000
SERVER_PORT=8000

# Frontend static files directory (absolute path)
FRONTEND_DIR=/app/frontend

# WebSocket broadcast channel capacity
BROADCAST_CAPACITY=100

# ============================================
# ACTIVITY THRESHOLDS
# ============================================
# Accelerometer threshold for fidgeting detection (in g-force)
# Values above this but below THRESH_ACTIVE are considered "FIDGET"
THRESH_FIDGET=0.020

# Accelerometer threshold for active movement detection (in g-force)
# Values above this are considered "ACTIVE"
THRESH_ACTIVE=0.040

# Sedentary alert threshold in seconds (default: 1200 = 20 minutes)
ALERT_LIMIT_SECONDS=1200

# ============================================
# ML ANALYTICS CONFIGURATION
# ============================================
# Cron schedule for nightly analytics (default: 2 AM daily)
# Format: minute hour day month weekday
# Examples:
#   0 2 * * *     - 2 AM every day
#   0 3 * * *     - 3 AM every day
#   0 */6 * * *   - Every 6 hours
#   0 0 * * 0     - Midnight every Sunday
ML_NIGHTLY_SCHEDULE=0 2 * * *

# Number of clusters for KMeans activity classification
ML_KMEANS_CLUSTERS=3

# Random state for reproducible KMeans results
ML_KMEANS_RANDOM_STATE=42

# Number of KMeans initialization attempts
ML_KMEANS_N_INIT=10

# Minimum samples required before running clustering analysis
ML_MIN_SAMPLES_FOR_CLUSTERING=100

# Expected sensor samples per minute (for time calculations)
# Default: 600 samples/min = 10 Hz sampling rate
ML_SAMPLES_PER_MINUTE=600

# ============================================
# LOINC / FHIR CONFIGURATION
# ============================================
# LOINC code for sedentary activity observation
# 87705-0 = "Sedentary activity 24 hour"
LOINC_CODE=87705-0
LOINC_DISPLAY=Sedentary activity 24 hour
LOINC_SYSTEM=http://loinc.org

# FHIR unit system (UCUM - Unified Code for Units of Measure)
FHIR_SYSTEM=http://unitsofmeasure.org

# ============================================
# LOGGING & MONITORING
# ============================================
# Log level for the application
# Options: trace, debug, info, warn, error
LOG_LEVEL=info

# Python logging (1 = unbuffered output for Docker)
PYTHONUNBUFFERED=1

# Rust logging level (comma-separated for specific modules)
# Examples:
#   info                    - Info level for all
#   debug                   - Debug level for all
#   server=debug,sqlx=warn  - Debug for server, warn for sqlx
RUST_LOG=info

# ============================================
# CACHE CONFIGURATION
# ============================================
# Number of recent sensor readings to keep in Redis
# This fills the frontend charts on reconnection
SENSOR_HISTORY_LIMIT=500

# Redis cache time-to-live in seconds
REDIS_CACHE_TTL_SECONDS=3600

# ============================================
# FALLBACK CONFIGURATION
# ============================================
# When hardware (Arduino) is unavailable, the fallback monitor
# detects the data gap and replays historical data from the database
# to keep the frontend charts populated.

# Seconds without serial data before triggering fallback mode
# Default: 5 seconds (lower for faster startup in cloud environments)
FALLBACK_TIMEOUT_SECONDS;

# Number of historical rows to fetch from sedentary_log during fallback
# Default: 500 rows (provides good chart coverage)
FALLBACK_BATCH_SIZE=500

# Milliseconds between replayed records during fallback
# Lower = faster replay, Higher = more realistic pacing
# Default: 100ms (10 records per second)
FALLBACK_REPLAY_INTERVAL_MS=100

# ============================================
# DEVELOPMENT NOTES
# ============================================
# 1. For local development, keep localhost URLs
# 2. For Docker deployment, the docker-compose.yml will override
#    DATABASE_URL and REDIS_URL with container hostnames
# 3. Generate a secure JWT_SECRET before deploying to production:
#    openssl rand -hex 32
# 4. Adjust THRESH_FIDGET and THRESH_ACTIVE based on your sensor
#    sensitivity and personal movement patterns
# 5. ML analytics will suggest adaptive thresholds in logs
